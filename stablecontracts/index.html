<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/black.css" id="theme">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-markdown>
					<textarea data-template>
				### Stable Contracts

				"All services, without exception, must be designed from the ground up to be externalizable.
				That is to say, the team must plan and design to be able to expose the interface to developers in the outside world.
				No exceptions. Anyone who doesn’t do this will be fired." - [Jeff Bezos, Api mandate, 2002](https://nordicapis.com/the-bezos-api-mandate-amazons-manifesto-for-externalization/)

					// Name: Jukka Nikki, Identity: Programmer, Since: 6502
					// TODO: Codeneering - reaching higher level of abstraction
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					## Theory & terminology
						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### [Design by contract (DbC), 1986, Bertram Meyer](https://en.wikipedia.org/wiki/Design_by_contract)

				<img alt="contracts" src="images/Design_by_contract.svg.png" width="30%">

				"formal, precise and verifiable interface specifications for software components,
				which extend the ordinary definition of abstract data types with preconditions,
				postconditions and invariants."
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### [The OpenAPI Initiative (OAI)](https://www.openapis.org/)

				"As an open governance structure under the [Linux Foundation](https://www.linuxfoundation.org/),
				the OAI is focused on creating, evolving and promoting a vendor neutral description format.
				The OpenAPI Specification was originally based on the [Swagger](https://swagger.io/) Specification,
				donated by [SmartBear Software](https://smartbear.com/)." - [OAI](https://www.openapis.org/)

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Approaches to api development

				<img alt="api continuum" src="images/api_continuum.png" width="60%">

				"An application programming interface (API) is a connection between computers or between computer programs.
				(..) A document or standard that describes how to build or use such a connection or interface is called an
				API specification." - [Wikipedia](https://en.wikipedia.org/wiki/API)

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Rest Api Maturity model

				<img alt="api maturity model" src="images/richardson-maturity-model.jpg" width="40%">

				Level three of [Richardson’s model](https://restfulapi.net/richardson-maturity-model/)
				encourages easy discoverability.
				This level makes responses self-descriptive by using [HATEOAS](https://en.wikipedia.org/wiki/HATEOAS).

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Hypertext Application Language

				<img alt="hal model" src="images/hal_model.png" width="40%">

				"[HAL](https://stateless.group/hal_specification.html) has two simple concepts.
				Resources with Links, Embedded Resources and State.
				Links with target, relation aka. 'rel' and few optional properties"

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Hypermedia as the engine of application state

				<img alt="state transitions" src="images/hateoas_state_transitions.png" width="60%">

				"The client transitions through application states by selecting from the links within
				a representation or by manipulating the representation in other ways afforded by its media type."

					</textarea>
				</section>


				<section data-markdown>
					<textarea data-template>
					## Where to start

					Code? .. Spec?

					every software architecture is cute at the start
						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### "Code" or Implementation First

				<img alt="code 1st" src="images/code-first.png" width="40%">

				"The Code First approach affords speed, automation and reduced process complexity,
				at the cost of good developer experience.
				If the API will only be consumed by the team or company that’s building it,
				then the Code First approach is an ideal solution." - [Swagger.io](https://swagger.io/blog/api-design/design-first-or-code-first-api-development/)

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Variant: Api Framework

				"API Framework method mixes the API implementation with its description

				Example: [HAL](https://stateless.group/hal_specification.html)+JSON makes [Spring HATEOAS](https://spring.io/projects/spring-hateoas)
				more closely align to an API description document.
				(..) generate an API description that conforms to OpenAPI using the [Springdoc](https://springdoc.org/) project." - [Kevin Sookocheff](https://sookocheff.com/post/api/the-false-dichotomoy-of-design-first-and-code-first-api-development/)

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### "Design" or Api First

				<img alt="design 1st" src="images/design-first.png" width="50%">

				"Once you have a complete description of how a REST API works, much of the way engineers work with APIs can be streamlined.
				For example:
			  Generate accurate documentation,
    		Create stub code for API development,
    		Build mock servers to prototype the interface,
				Test that API requests and responses match the intended contract" - [Stoplight.io](https://stoplight.io/openapi/)

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Variant: Coded API Description (DSL)

				"Coded API Description involves leveraging a programming language to create your API description.

				Example: With [Spot](https://github.com/airtasker/spot) TypeScript classes define the API
				and interfaces are used to represent the request and response bodies.
				Annotations specific to [Spot](https://github.com/airtasker/spot) are used to fill out the rest of the API description.
				(..) you can use [Spot](https://github.com/airtasker/spot) to generate your OpenAPI description document" - [Kevin Sookocheff](https://sookocheff.com/post/api/the-false-dichotomoy-of-design-first-and-code-first-api-development/)

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					## Case study
					Sping Boot + Spring Hateoas + Spring Data MongoDb + springdoc

					[Test project](https://github.com/nikkijuk/pigeongram/) contains
					[handwritten Open Api docs](https://github.com/nikkijuk/pigeongram/blob/main/specs/api.yaml) and open api docs generation from code
						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Spring Hateoas 1.0 Release (0.1 2012, [1.0 2019](https://spring.io/blog/2019/03/05/spring-hateoas-1-0-m1-released))

				<img alt="spring hateoas 1.0 classes" src="images/spring_hateoas_model_classes.svg" width="50%">

				<img alt="spring hateoas 1.0 changes" src="images/spring_hateoas_100.png" width="70%">

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Spring Hateoas [entities and collections](https://docs.spring.io/spring-hateoas/docs/current/reference/html/#fundamentals.entity-model)

				<img alt="spring hateoas collection and entity models" src="images/entity_collection_models.png" width="80%">

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					#### Models and data mapping

					<img alt="mapping data" src="images/signature_mapping_domain.png" width="90%">

					Domain class has [import alias](https://kotlinlang.org/docs/packages.html#imports) to reduce name clashes

					Immutable [data class](https://kotlinlang.org/docs/data-classes.html) with 4 attributes

					[Extension functions](https://kotlinlang.org/docs/extensions.html#extension-functions) for api <-> domain mapping

						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					#### [Hal Representation from DTO](https://docs.spring.io/spring-hateoas/docs/1.2.11/api/org/springframework/hateoas/server/RepresentationModelAssembler.html)

					<img alt="hal representation" src="images/signature_assembling_representation_v1.png" width="90%">

					Domain and Api classes have [import aliases](https://kotlinlang.org/docs/packages.html#imports)

					toModel (..) uses [Sping-hateoas](https://spring.io/projects/spring-hateoas) classes to create [hal](https://stateless.group/hal_specification.html) representations

						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					#### Controller: create

					<img alt="hateoas controller create" src="images/signature_controller_create_v1.png" width="90%">

					use domain services

					assemble [entity model](https://docs.spring.io/spring-hateoas/docs/current/api/org/springframework/hateoas/EntityModel.html) from api model

					return [entity model](https://docs.spring.io/spring-hateoas/docs/current/api/org/springframework/hateoas/EntityModel.html) within response

						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					#### Controller: get one, get all

					<img alt="hateoas controller get" src="images/signature_controller_one_all_v1.png" width="90%">

					for one item return [entity model](https://docs.spring.io/spring-hateoas/docs/current/api/org/springframework/hateoas/EntityModel.html)

					for multiple items return [collection model](https://docs.spring.io/spring-hateoas/docs/current/api/org/springframework/hateoas/CollectionModel.html)

						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					#### Get 2nd signature

					<img alt="signature get 2" src="images/signature_get_2.png" width="70%">

					curl -v localhost:8080/signatures/1 | json_pp

						</textarea>
				</section>


				<section data-markdown>
					<textarea data-template>
				#### Reverse engineering / Documenting

				<img alt="generation" src="images/org-sringdoc-openapi-gradle-plugin.png" width="50%">

					implementation("org.springdoc:springdoc-openapi-ui:1.5.12")
					implementation("org.springdoc:springdoc-openapi-webmvc-core:1.5.12")
					implementation("org.springdoc:springdoc-openapi-kotlin:1.5.12")
					implementation("org.springdoc:springdoc-openapi-javadoc:1.5.12")

					openApi {
							outputDir.set(file("$buildDir/docs"))
							outputFileName.set("api.json")
					}

				Use [Gradle plugin](https://github.com/springdoc/springdoc-openapi-gradle-plugin)
				with [Springdoc](https://springdoc.org/) dependencies

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Live documentation

				<img alt="live docs" src="images/springdoc-swagger-ui.png" width="50%">

				Inspect with [Swagger ui](https://swagger.io/tools/swagger-ui/) or as raw data.

				- /swagger-ui.html
				- /v3/api-docs	(json)
				- /v3/api-docs.yaml (yaml download)

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Json in Firefox

				<img alt="live docs" src="images/signatures-create-json.png" width="50%">

				Post **/signatures** return type missed by [SpringDoc](https://springdoc.org/)

				Created OpenApi document does not match implementation
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Swagger-ui view

				<img alt="live docs" src="images/signatures-swagger-ui.png" width="50%">

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Forward engineering / Generation

				<img alt="generation" src="images/org-openapi-generator.png" width="50%">


					openApiGenerate {
							generatorName.set("kotlin-spring")
							inputSpec.set("$rootDir/api.yaml")
							outputDir.set("$buildDir/generated")
							modelPackage.set("com.test.model")
							apiPackage.set("com.test.api")
							configOptions.set(..


				Use [Gradle plugin](https://plugins.gradle.org/plugin/org.openapi.generator)
				with ["kotlin-spring"](https://openapi-generator.tech/docs/generators/kotlin-spring/) generator


					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					#### Editing open api at idea as yaml

					<img alt="live docs" src="images/edit_user_post.png" width="40%">

					Checks format, highlights keywords, but still only text.

						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					#### Visual editors might fit to some users

					<img alt="live docs" src="images/reverse-engineered-signature.png" width="90%">

					Try standalone and web based editors
					[Apicurio](https://www.apicur.io/),
					[Stoplight Studio](https://stoplight.io/studio/),
					[Swagger editor](https://editor.swagger.io/),
					[SwaggerHub](https://swagger.io/tools/swaggerhub/)

					Tested Stoplight studio, swagger editor and swagger hub. Still prefer IDEA.

						</textarea>
				</section>


				<section data-markdown>
					<textarea data-template>
					#### Linting using Zalando Rules

					<img alt="linting" src="images/linter_zally_violations.png" width="90%">

					Start [Zally](https://github.com/zalando/zally) server, see [api docs](https://github.com/zalando/zally/blob/master/server/zally-server/src/main/resources/api/zally-api.yaml), lint, fix, ..

					POST localhost:8000/api-violations { "api_definition_url": ["../api.yaml"]("https://raw.githubusercontent.com/nikkijuk/pigeongram/main/specs/api.yaml")}

						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					#### Templating with [openapi-generator.tech](https://openapi-generator.tech/)

					"For maybe 90% of use cases (..) modify the mustache template files to create your own custom generated code." - [Open api generator](https://openapi-generator.tech/docs/templating/)

					<img alt="linting" src="images/kotlin-openapi-spingboot-functional-template.png" width="70%">

					"[kotlin-swagger-spring-functional](https://github.com/cdimascio/kotlin-openapi-spring-functional-template) (..) for Kotlin Spring WebFlux (..)
					provides 12-factor compliant environment based config and integrated in linting."

						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### [Generation Gap Pattern](https://en.wikipedia.org/wiki/Generation_gap_(pattern))

				"Modifications should not be made to generated code,
				as they would be overwritten if the code generation process was ever re-run" - John Vlissides

				With open api

				- Encapsulate generated code within web adapter
				- Generate api data structures and annotated interfaces for controllers
				- Make sure generated code matches with your other code (datatypes, naming, ..)
				- Define clear boundaries - Don't generate too much!

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					## Use cases, ideas, tools, ..
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Mock before you Rock

				<img alt="live mocs" src="images/prism-open-api-mocking.png" width="50%">

				Use [Stoplights](https://stoplight.io/) [Prism](https://stoplight.io/open-source/prism/) to mimic your API’s behavior as if you already built it.
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Live contract testing with [Prism](https://stoplight.io/open-source/prism/)

				"Unlike mocking, the [validation proxy](https://meta.stoplight.io/docs/prism/ZG9jOjk3-validation-proxy)
				expects there to be a real API running somewhere.

				The proxy feature will help you identify discrepancies between the OpenAPI document
				and any other server you designate as the target. This can help frontend developers integrating with your API

				The proxy can also be enabled in staging or any other pre-production environment."
					</textarea>
				</section>


				<section data-markdown>
					<textarea data-template>
				#### Collaborate, share, enforce rules

				<img alt="live edit" src="images/swaggerhub-open-api-collaboration.png" width="70%">

				Use [SwaggerHub](https://swagger.io/tools/swaggerhub/) as your single source of truth for API definitions
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Testing

				<img alt="live edit" src="images/readyapi-open-api-testing.png" width="70%">

				Use [readyApi](https://smartbear.com/product/ready-api/) to accelerate
				functional, security, and load testing of RESTful, SOAP, GraphQL and other web services right inside your CI/CD pipeline
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					## Thoughts
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>

				"Programmers know the benefits of everything and the tradeoffs of nothing" - Rich Hickey

				<img alt="api tradeoffs" src="images/design-first-vs-code-first-swaggerhub-graphic.png" width="40%">

				Speed vs. Purity? Agility vs. Process? Developer vs. ..?

				What we trade against each other? Who's in charge?
						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### [Not for cowboy coders..](https://en.wikipedia.org/wiki/Cowboy_coding)

				<img alt="api tradeoffs" src="images/must_api_first.png" width="70%">

				"API First obviously is in conflict with the bad practice of publishing API definition
				and asking for peer review after the service integration or
				even the service productive operation has started." - [Zalando](https://opensource.zalando.com/restful-api-guidelines/#api-first)

						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### Events and asynchronous messaging

				<img alt="events" src="images/zalando-events-api-guidelines.png" width="70%">

				Define [Events](https://opensource.zalando.com/restful-api-guidelines/#events) using clear conventions.

				"What distinguishes events from other kinds of data is the delivery style used,
				asynchronous publish-subscribe messaging.
				But there is no reason why they could not be made available using a REST API"	- [Zalando](https://opensource.zalando.com/restful-api-guidelines/#events)

					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>

				<img alt="may use hateoas" src="images/may_use_hateoas.png" width="70%">

				"However, we do not forbid HATEOAS; you could use it,
				if you checked its limitations and still see clear value for your usage scenario
				that justifies its additional complexity." - [Zalando](https://opensource.zalando.com/restful-api-guidelines/#163)

				"(..) in today’s industry full HATEOAS compliant APIs are a very rare exception." - [Zalando](https://opensource.zalando.com/restful-api-guidelines/#_footnotedef_1)

						</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
					## End
					</textarea>
				</section>

				<section data-markdown>
					<textarea data-template>
				#### [Is High Quality Software Worth the Cost?](https://martinfowler.com/articles/is-quality-worth-cost.html)

				<img alt="quality & cost" src="images/quality_tradeoff_pseudo_graph.png" width="40%">

				"(..) there is a period where the low internal quality is more productive than the high track.
				During this time there is some kind of trade-off between quality and cost.
				The question, of course, is: how long is that period before the lines cross?" - Martin fowler
				</textarea>
				</section>


			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
